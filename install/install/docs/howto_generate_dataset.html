<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SIBR: Dataset Structure and Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SIBR
   &#160;<span id="projectnumber">0.9.3-50-gf5866f7</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('howto_generate_dataset.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Dataset Structure and Generation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Most <em>Projects</em> take as input a <em>multi-view dataset</em>, i.e., a set of images taken using a camera (phone, DSLR, videocamera such as GoPro etc).</p>
<p>In almost all cases we assume that a Structure-from-Motion (SfM) algorithm has been run on the input images to generate <em>calibrated cameras</em>, and most often a second Multi-View Stereo (MVS) step has been run, to generate a reconstructed 3D mesh. Optionally, we may also use dense depth maps that come from MVS.</p>
<p>In <b>SIBR</b> we have a `&lsquo;native&rsquo;' dataset format, described below, which was used traditionally for some of the original <em>Projects</em>. For most recent projects we have used the commercial tool RealityCapture for SfM/MVS, since it tends to produce the best overall reconstruction quality. In some recent projects (e.g., DeepBlending, or SemanticCars, see <a class="el" href="projects.html">Projects</a>), we have used <em>Colmap</em>, since the dense per-view depth maps are very useful.</p>
<p>As a result, <b>SIBR</b> supports two types of dataset natively:</p>
<ul>
<li>Native <b>SIBR</b> datasets, created using the tools described below, from RealityCapture or Colmap. We provide pre-processing documentation following which you can create SIBR compatible datasets from output of these two SfM/MVS systems:<ul>
<li><a class="el" href="HowToCapreal.html">How to create a dataset from Reality Capture</a></li>
<li><a class="el" href="HowToColmap.html">How to create a dataset from Colmap</a></li>
</ul>
</li>
</ul>
<ul>
<li>Native Colmap datasets: we simply create a metadata file the first time the dataset is read.</li>
</ul>
<p>Different <em>Projects</em> often add additional information to their datasets, typically via multiple pre-processing utilities, some general, some specific to the <em>Project</em>. Python scripts designed to process and prepare datasets are provided with each project along with instructions on how to use them in the corresponding documentation.</p>
<h1><a class="anchor" id="howto_generate_dataset_sibr_format"></a>
Basic SIBR Dataset Structure and Generation</h1>
<p>The basic structure of and <b>SIBR</b> dataset is shown below: <br  />
</p><div class="image">
<img src="sibr_dataset.png" alt=""/>
<div class="caption">
An SIBR dataset directory structure after preprocessing</div></div>
<p><br  />
 The directory structure is as follows:</p>
<ul>
<li>The <em>cameras</em> directory contains the calibrated cameras, using the <em>Bundler</em> format by default (<a class="el" href="howto_generate_dataset.html#subsecDataSetFormatsBundle">The bundle.out file</a>).</li>
</ul>
<ul>
<li>The <em>images</em> directory that contains the undistorted images from the reconstruction and the list images file (<a class="el" href="howto_generate_dataset.html#subsecDataSetFormatsListImg">The list_images.txt file</a>)</li>
</ul>
<ul>
<li>The <em>meshes</em> directory that contains a <em>recon.ply</em> file that is the 3D reconstruction of the scene and the texture</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000032">Todo:</a></b></dt><dd>FIX THE TEXTURE PLACEMENT ISSUE</dd></dl>
<p>To generate a dataset after following the procedure for RealityCapture, you need to perform the following steps:</p>
<ul>
<li>Generate and build the solution to generate executables for preprocessing applications. </li>
<li>Go to <code>install\scripts</code> </li>
<li>Run the python script using<div class="fragment"><div class="line">python <a class="code" href="namespaceibr__preprocess__rc__to__sibr.html">ibr_preprocess_rc_to_sibr</a>.py -i original_dataset_path -o new_dataset_path --bin path_to_sibr_bin </div>
</div><!-- fragment --> </li>
<li>Specifying the binaries directory is optional. While compiling cmake automatically generates settings file which is parsed by the script to set bin directory. </li>
<li>The script calls the distordCrop, cropFromCenter, and clipping_planes app executables; make sure they are up to date.<ul>
<li>They crop the images to remove the black borders; the &ndash;ratio parameter to distordCrop (currently 0.2 (/.5)) sets the percentage of border which can be removed. Images that have larger black borders are removed from the dataset.</li>
<li>They also copy the meshes (ply and obj if available) and modifies the bundle.out and list_images.txt to the new values of resolution, and removes the images excluded (the numbers can be found in Dataset\SibrData\raw\excluded_images.txt)</li>
<li>Next they compute the clipping planes for each camera corresponding to input images and stores them in a clipping_planes.txt file.</li>
<li>Finally, they parse all data to create a scene_metadata.txt file which holds information of the images, clipping planes etc. and is used to create the scene. This file can be manually extended. </li>
</ul>
</li>
<li><em>[Recommended]</em> If you do not want to create a copy of the dataset, you can only specify the input directory with -i option. The dataset will be generated within the input directory itself. <br  />
<br  />
</li>
</ul>
<h2><a class="anchor" id="subsecInputDatasetFilesFormats"></a>
Dataset Files and Formats</h2>
<p><br  />
 The following sections contain documentation of the various files used in the dataset. Some are inherited from other SfM/MVS solutions. </p>
<h2><a class="anchor" id="subsecMetadataFile"></a>
The metadata.txt file</h2>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000033">Todo:</a></b></dt><dd>Add this <br  />
</dd></dl>
<h2><a class="anchor" id="subsecDataSetFormatsBundle"></a>
The bundle.out file</h2>
<p><br  />
 Content: <a href="http://www.cs.cornell.edu/~snavely/bundler/bundler-v0.4-manual.html">the bundler documentation</a> explain all what it contain <br  />
 Description: <a href="http://www.cs.cornell.edu/~snavely/bundler/bundler-v0.4-manual.html#S6">the output of the bundler</a> <br  />
 Bundle file format is in plain text :<br  />
</p><div class="fragment"><div class="line"><span class="preprocessor"># Bundle file v0.3</span></div>
<div class="line">&lt;num_cameras&gt; &lt;num_points&gt;   [two integers]</div>
<div class="line">&lt;camera1&gt;</div>
<div class="line">&lt;camera2&gt;</div>
<div class="line">  ...</div>
<div class="line">&lt;cameraN&gt;</div>
<div class="line">&lt;point1&gt;</div>
<div class="line">&lt;point2&gt;</div>
<div class="line">   ...</div>
<div class="line">&lt;pointM&gt;</div>
</div><!-- fragment --><p>Where &lt;camera&gt; contain : </p><div class="fragment"><div class="line">&lt;f&gt; &lt;k1&gt; &lt;k2&gt;   [the focal <a class="code" href="group__sibr__system.html#gace0dc0666af333352d46391905a46285">length</a>, followed by two radial distortion coeffs]</div>
<div class="line">&lt;<a class="code" href="namespacesibr_1_1Key.html#a0362976574888ce696967db1a13ebbd9a18a45d93621c724c7ddceaddf2816539">R</a>&gt;             [a 3x3 matrix representing the camera rotation]</div>
<div class="line">&lt;t&gt;             [a 3-vector describing the camera translation]</div>
</div><!-- fragment --><p>And where &lt;point&gt; contain : </p><div class="fragment"><div class="line">&lt;position&gt;      [a 3-vector describing the 3<a class="code" href="namespacesibr_1_1Key.html#a0362976574888ce696967db1a13ebbd9a298799764382395bc84e3818a7269d54">D</a> position of the point]</div>
<div class="line">&lt;<a class="code" href="namespacecolor.html">color</a>&gt;         [a 3-vector describing the RGB <a class="code" href="namespacecolor.html">color</a> of the point]</div>
<div class="line">&lt;view list&gt;     [a list of views the point is visible in]</div>
</div><!-- fragment --><h2><a class="anchor" id="subsecDataSetFormatsListImg"></a>
The list_images.txt file</h2>
<p>Content: It a list of all input images sorted by order it was taken (renamed) with their resolution <br  />
 Description: If you have <a href="http://www.imagemagick.org/script/command-line-options.php#format_identify_">ImageMagick</a> you can do : <code>identify -format "%f %w %h\n" *.jpg</code> <br  />
</p><div class="fragment"><div class="line">&lt;%8d.jpg&gt; &lt;width&gt; &lt;height&gt;</div>
</div><!-- fragment --><p>Example: </p><div class="fragment"><div class="line">00000000.jpg 2256 1504</div>
<div class="line">00000001.jpg 2256 1504</div>
<div class="line">00000002.jpg 2256 1504</div>
<div class="line">...</div>
<div class="line">00000026.jpg 2256 1504</div>
<div class="line">00000027.jpg 2256 1504</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacecolor_html"><div class="ttname"><a href="namespacecolor.html">color</a></div><div class="ttdef"><b>Definition:</b> <a href="color_8py_source.html#l00001">color.py:1</a></div></div>
<div class="ttc" id="anamespacesibr_1_1Key_html_a0362976574888ce696967db1a13ebbd9a18a45d93621c724c7ddceaddf2816539"><div class="ttname"><a href="namespacesibr_1_1Key.html#a0362976574888ce696967db1a13ebbd9a18a45d93621c724c7ddceaddf2816539">sibr::Key::R</a></div><div class="ttdeci">@ R</div><div class="ttdef"><b>Definition:</b> <a href="Input_8hpp_source.html#l00057">Input.hpp:57</a></div></div>
<div class="ttc" id="agroup__sibr__system_html_gace0dc0666af333352d46391905a46285"><div class="ttname"><a href="group__sibr__system.html#gace0dc0666af333352d46391905a46285">sibr::length</a></div><div class="ttdeci">T length(const Eigen::Matrix&lt; T, N, 1, Options &gt; &amp;A)</div><div class="ttdoc">Return the length of a vector.</div><div class="ttdef"><b>Definition:</b> <a href="Vector_8hpp_source.html#l00109">Vector.hpp:109</a></div></div>
<div class="ttc" id="anamespaceibr__preprocess__rc__to__sibr_html"><div class="ttname"><a href="namespaceibr__preprocess__rc__to__sibr.html">ibr_preprocess_rc_to_sibr</a></div><div class="ttdef"><b>Definition:</b> <a href="ibr__preprocess__rc__to__sibr_8py_source.html#l00001">ibr_preprocess_rc_to_sibr.py:1</a></div></div>
<div class="ttc" id="anamespacesibr_1_1Key_html_a0362976574888ce696967db1a13ebbd9a298799764382395bc84e3818a7269d54"><div class="ttname"><a href="namespacesibr_1_1Key.html#a0362976574888ce696967db1a13ebbd9a298799764382395bc84e3818a7269d54">sibr::Key::D</a></div><div class="ttdeci">@ D</div><div class="ttdef"><b>Definition:</b> <a href="Input_8hpp_source.html#l00043">Input.hpp:43</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
